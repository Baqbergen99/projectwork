{% load i18n %}
<!DOCTYPE html>
<html>
<head>
    <title>{% if CURRENT_LANGUAGE == 'ru' %}–ê—Ä–µ–Ω–¥–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏{% elif CURRENT_LANGUAGE == 'en' %}Property Rental{% elif CURRENT_LANGUAGE == 'kk' %}–ñ—ã–ª–∂—ã–º–∞–π—Ç—ã–Ω –º“Ø–ª—ñ–∫—Ç—ñ –∂–∞–ª“ì–∞ –∞–ª—É{% else %}–ê—Ä–µ–Ω–¥–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏{% endif %} - {% block title %}{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding-top: 60px;
        }
        .navbar-brand {
            font-weight: bold;
        }
        .profile-dropdown {
            margin-left: auto;
        }
        .language-selector {
            margin-left: 15px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="{% url 'task-list' %}">
                {% if CURRENT_LANGUAGE == 'ru' %}–ê—Ä–µ–Ω–¥–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
                {% elif CURRENT_LANGUAGE == 'en' %}Property Rental
                {% elif CURRENT_LANGUAGE == 'kk' %}–ñ—ã–ª–∂—ã–º–∞–π—Ç—ã–Ω –º“Ø–ª—ñ–∫—Ç—ñ –∂–∞–ª“ì–∞ –∞–ª—É
                {% else %}–ê—Ä–µ–Ω–¥–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏{% endif %}
            </a>
            <div class="navbar-nav">
                <a class="nav-link" href="{% url 'about' %}">
                    {% if CURRENT_LANGUAGE == 'ru' %}–û –Ω–∞—Å
                    {% elif CURRENT_LANGUAGE == 'en' %}About Us
                    {% elif CURRENT_LANGUAGE == 'kk' %}–ë—ñ–∑ —Ç—É—Ä–∞–ª—ã
                    {% else %}–û –Ω–∞—Å{% endif %}
                </a>
                {% if user.is_authenticated %}
                    {% if user.is_staff %}
                        <a class="nav-link" href="{% url 'task-create' %}">
                            {% if CURRENT_LANGUAGE == 'ru' %}–î–æ–±–∞–≤–∏—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—É
                            {% elif CURRENT_LANGUAGE == 'en' %}Add Apartment
                            {% elif CURRENT_LANGUAGE == 'kk' %}–ü”ô—Ç–µ—Ä “õ–æ—Å—É
                            {% else %}–î–æ–±–∞–≤–∏—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—É{% endif %}
                        </a>
                    {% endif %}
                {% else %}
                    <a class="nav-link" href="{% url 'register' %}">
                        {% if CURRENT_LANGUAGE == 'ru' %}–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                        {% elif CURRENT_LANGUAGE == 'en' %}Register
                        {% elif CURRENT_LANGUAGE == 'kk' %}–¢—ñ—Ä–∫–µ–ª—É
                        {% else %}–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è{% endif %}
                    </a>
                    <a class="nav-link" href="{% url 'login' %}">
                        {% if CURRENT_LANGUAGE == 'ru' %}–í—Ö–æ–¥
                        {% elif CURRENT_LANGUAGE == 'en' %}Login
                        {% elif CURRENT_LANGUAGE == 'kk' %}–ö—ñ—Ä—É
                        {% else %}–í—Ö–æ–¥{% endif %}
                    </a>
                {% endif %}
            </div>
            
            <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–æ–≤ -->
            <div class="language-selector dropdown">
                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="languageDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    {% if CURRENT_LANGUAGE == 'ru' %}
                        üá∑üá∫ –†—É—Å—Å–∫–∏–π
                    {% elif CURRENT_LANGUAGE == 'en' %}
                        üá¨üáß English
                    {% elif CURRENT_LANGUAGE == 'kk' %}
                        üá∞üáø “ö–∞–∑–∞“õ—à–∞
                    {% endif %}
                </button>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="languageDropdown">
                    <li>
                        <form action="{% url 'change_language' 'ru' %}" method="post">
                            {% csrf_token %}
                            <button type="submit" class="dropdown-item">üá∑üá∫ –†—É—Å—Å–∫–∏–π</button>
                        </form>
                    </li>
                    <li>
                        <form action="{% url 'change_language' 'en' %}" method="post">
                            {% csrf_token %}
                            <button type="submit" class="dropdown-item">üá¨üáß English</button>
                        </form>
                    </li>
                    <li>
                        <form action="{% url 'change_language' 'kk' %}" method="post">
                            {% csrf_token %}
                            <button type="submit" class="dropdown-item">üá∞üáø “ö–∞–∑–∞“õ—à–∞</button>
                        </form>
                    </li>
                </ul>
            </div>
            
            {% if user.is_authenticated %}
                <div class="profile-dropdown dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="profileDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        {{ user.username }}
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
                        <li><a class="dropdown-item" href="{% url 'profile' %}">
                            {% if CURRENT_LANGUAGE == 'ru' %}–ü—Ä–æ—Ñ–∏–ª—å
                            {% elif CURRENT_LANGUAGE == 'en' %}Profile
                            {% elif CURRENT_LANGUAGE == 'kk' %}–ü—Ä–æ—Ñ–∏–ª—å
                            {% else %}–ü—Ä–æ—Ñ–∏–ª—å{% endif %}
                        </a></li>
                        <li><a class="dropdown-item" href="{% url 'edit-profile' %}">
                            {% if CURRENT_LANGUAGE == 'ru' %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
                            {% elif CURRENT_LANGUAGE == 'en' %}Edit Profile
                            {% elif CURRENT_LANGUAGE == 'kk' %}–ü—Ä–æ—Ñ–∏–ª—å–¥—ñ ”©“£–¥–µ—É
                            {% else %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å{% endif %}
                        </a></li>
                        <li><a class="dropdown-item" href="{% url 'logout' %}">
                            {% if CURRENT_LANGUAGE == 'ru' %}–í—ã—Ö–æ–¥
                            {% elif CURRENT_LANGUAGE == 'en' %}Logout
                            {% elif CURRENT_LANGUAGE == 'kk' %}–®—ã“ì—É
                            {% else %}–í—ã—Ö–æ–¥{% endif %}
                        </a></li>
                    </ul>
                </div>
            {% endif %}
        </div>
    </nav>
    <div class="container">
        {% block content %}{% endblock %}
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ AJAX
        function translateText(text, language, callback) {
            const formData = new FormData();
            formData.append('text', text);
            formData.append('language', language);
            
            fetch('{% url "translate" %}', {
                method: 'POST',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]')?.value || ''
                },
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.translated) {
                    callback(data.translated);
                }
            })
            .catch(error => console.error('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–∞:', error));
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —è–∑—ã–∫–∞
        document.querySelectorAll('.language-selector a').forEach(function(link) {
            link.addEventListener('click', function(e) {
                // –Ø–∑—ã–∫ —É–∂–µ –±—É–¥–µ—Ç –∏–∑–º–µ–Ω–µ–Ω —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
                // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞
                localStorage.setItem('preferredLanguage', this.href.split('/').pop());
            });
        });
    });
    </script>
</body>
</html>